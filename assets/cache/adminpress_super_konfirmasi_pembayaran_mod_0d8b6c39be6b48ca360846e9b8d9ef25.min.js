
$(document).ready(function(){function addCommas(nStr)
{nStr+='';x=nStr.split('.');x1=x[0];x2=x.length>1?'.'+x[1]:'';var rgx=/(\d+)(\d{3})/;while(rgx.test(x1)){x1=x1.replace(rgx,'$1'+','+'$2');}
return x1+x2;}
var tabel_data_pembayaran=$('#tabel_data_pembayaran').DataTable({ajax:url+'listener_show_all',processing:true,columns:[{sName:"id"},{sName:"tanggal"},{sName:"nomer"},{sName:"nama"},{sName:"ket"},{sName:"status"},{sName:"detail"}],dom:'Bfrtip',buttons:['copy','csv','excel','pdf','print']});var pembayaran_detail_ota=$('#pembayaran_detail_ota').DataTable({ajax:url+'listener_get_pembayaran_detail_ota',processing:true,columns:[{sName:"nama santri"},{sName:"nama pesantren"},{sName:"lama Membiayai"},{sName:"biaya perbulan"},],});var pembayaran_detail_project=$('#pembayaran_detail_project').DataTable({ajax:url+'listener_get_pembayaran_detail_project',processing:true,columns:[{sName:"nama Project"},{sName:"Kebutuhan Dana"},{sName:"Jumlah Donasi"},],});var pembayaran_detail_psb=$('#pembayaran_detail_psb').DataTable({ajax:url+'listener_get_pembayaran_detail_psb',processing:true,columns:[{sName:"nama santri"},{sName:"pendidikan terakhir"},{sName:"nama Pesantren"},{sName:"Biaya Administrasi"}],});$('#form_filter_data_pembayaran').on('submit',function(e){e.preventDefault();var new_url='';new_url=url+"listener_get_filter_data_pembayaran/"+$('#nama_pesantren').val()+'/'+$('#tipe').val()+'/'+$('#status').val()
tabel_data_pembayaran.ajax.url(new_url).load();});$(document).on('click','.detail',function(){var id_invoice=$(this).data('id');var role_id=$(this).data('role');var nomer=$(this).data('nomor');var total=$(this).data('total');$('#id_invoice').val(id_invoice);$('#total').val(total);var new_url_ota=url+'listener_get_pembayaran_detail_ota/'+id_invoice;var new_url_project=url+'listener_get_pembayaran_detail_project/'+id_invoice;pembayaran_detail_ota.ajax.url(new_url_ota).load();pembayaran_detail_project.ajax.url(new_url_project).load();$('#modal_detail .modal-title').html('Detail Invoice <strong class="text-success">'+nomer+'</strong>');$('#modal_detail .modal-footer').html('Total Pembayaran : Rp.  <strong class="text-danger"> '+addCommas(total)+'</strong>');if(role_id==9){$('#modal_detail').modal('show');}
else if(role_id==8){$('#modal_detail_psb').modal('show');}})
$(document).on('click','.cek_bukti',function(){var id_invoice=$(this).data('id');var foto=$(this).data('foto');var token=$('input[name="ci_csrf_token"]').val();$.ajax({type:'post',url:url+'get_konfirmasi_pembayaran',data:{id:id_invoice},dataType:'json',success:function(dt){$('#modal_cek_bukti .modal-title').html('Pembayaran <strong class="text-success">'+id_invoice+'</strong>');$('#modal_cek_bukti input[name="id"]').val(dt.id);$('#modal_cek_bukti input[name="nama_pengirim"]').val(dt.nama_pengirim);$('#modal_cek_bukti input[name="nama_bank"]').val(dt.nama_bank);$('#modal_cek_bukti input[name="rekening_tujuan"]').val(dt.rekening_tujuan);$('#modal_cek_bukti input[name="keterangan"]').val(dt.keterangan);$('#modal_cek_bukti .modal-foto').html('<img class="form-control" src='+foto+' width="100%">');$('#modal_cek_bukti').modal('show');}});})
$(document).on('click','.validasi',function(){var id_status_pesantren=$(this).data('id');$('#id_status').val(id_status_pesantren)
$('#modal_confirm_validasi').modal('show');})
$(document).on('click','#confirm_validasi',function(){var id_status_pesantren=$('#id_status').val();$.ajax({type:'post',url:url+'validasi',data:{id:id_status_pesantren},dataType:'json',success:function(dt){tabel_data_pembayaran.ajax.reload();}});})})